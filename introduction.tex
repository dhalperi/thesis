\ifx\mainfile\undefined
\input{chapter_head}
\setcounter{chapter}{0} % Set to n-1!
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Introduction}
\label{chap:intro}

Wireless communication forms the dominant consumer-facing networking technology in the world. Billions of people worldwide use cellular phones to provide global voice communication service, and in the past decade smartphones have begun to provide digital access to the Internet for mobile connectivity. These innovations have revolutionized the way people interact with their devices, with each other, and with the world.

Cellular data networks provide mobile connectivity to the Internet over a long range and at relatively low rates. Complementing these, Wi-Fi (IEEE~802.11~\cite{80211}) is used today in locations such as caf\'{e}s, shopping malls, corporate offices, and homes to provide connectivity at much higher rates over much shorter range. With its low cost, small physical footprint, and dramatically increased speeds (up to 600\Mbps in IEEE~802.11n~\cite{80211n}), Wi-Fi is not limited to traditional computing devices such as laptop and desktop computers, but is also being adopted by consumer electronics such as televisions and DVD players. An ABI Research report~\cite{ABI_Research_2010} forecast that more than half of the 1 billion Wi-Fi chipsets shipped in 2011 would be used in consumer electronics.
%, Wi-Fi today connects devices such as laptops, desktops, tablets, and phones to the Internet at high-speed.
%The latest revision to Wi-Fi, called IEEE~802.11n~\cite{80211n}, enables individual devices to transmit data as fast as 600\Mbps.

Due to its dramatic improvement in recent years and rapid adoption in a diverse set of devices, Wi-Fi is thus at the heart of the next networking revolution: the combining of these diverse consumer devices to build rich applications that leverage each device's unique features, rather devices that simply interact with the Internet at large. A new protocol, called Wi-Fi Direct~\cite{wifi_direct} was standardized in late 2010 to enable Wi-Fi devices to form networks that better match their applications. Wi-Fi Direct has seen great uptake: a second ABI Research study~\cite{ABI_Research_2011}, conducted in late 2011, forecast a 50\% annual growth rate for Wi-Fi Direct support and predicted that there will be 2~billion Wi-Fi Direct-enabled devices by 2016.

%The next networking revolution will be for local wireless networks, in the enterprise and especially in the home.
%%, short-range, high-rate local area networks in the
%% enterprise and the
%%home that complement cellular networks.
%, these indoor networks will be used to build rich device-to-device applications in a comparably small area and at much higher rates. Wi-Fi (IEEE 802.11) is the dominant consumer wireless technology, and 
%By both dwarfing the speeds of commercial cellular networks and enabling much denser deployments of many devices that use unlicensed spectrum, Wi-Fi is on the cusp of enabling a new generation of rich device-to-device applications.
%Already, consumer electronics have begun gaining Wi-Fi functionality with dramatic uptake: a 2011 ABI Research report measured a 50\% annual growth rate of devices that support Wi-Fi Direct~\cite{wifi_direct} (a new standard protocol for device-to-device networks) and forecasts that there will be 2~billion Wi-Fi Direct-enabled devices by 2016.
%
%With this shift, the decades-old ``Internet of Things'' vision is becoming a reality, and researchers have begun building systems such as HomeOS~\cite{Dixon_HomeOS} to design, implement, and program applications that run across the devices in a home.
%Now that network-ready consumer devices are available, protocols to connect them have been developed, and systems to control them and help them interoperate are being researched, we have most of the pieces to build the home networks that will support these rich new applications. The last networking component, identified in studies of users who have deployed inchoate versions of home networking systems~\cite{Brush_HomeAutomation}, is a reliable, high-bandwidth wireless network to keep these home devices connected.

%This change is happening fast: an ABI Research report from late 2010 forecast the shipment of 1~billion Wi-Fi (IEEE 802.11~\cite{80211}) chipsets in 2011, with more than half of these chipsets used in consumer electronics, handsets, and other mobile devices. 

Despite these great technology, standardization, and adoption trends, one major factor challenges these future rich wireless applications. While wireless networks have significant potential for speed, capacity, and reliability, realizing these benefits requires that the network is configured in an efficient and effective way, and that it can adapt rapidly to changing conditions. The issue is that the underlying Wi-Fi technologies and network architectures have become rather complex, and how to configure and control them has become a significant decision problem without a simple, comprehensive solution.

In this thesis, I develop a practical solution to this problem. In particular, I develop a comprehensive metric to inform these complex decision problems using information available in commercial commodity Wi-Fi hardware. Throughout the rest of this chapter, I first explain in further detail the problem (\secref{sec:intro_problem}), then present my approach to solving it (\secref{sec:intro_approach}). I conclude this chapter by discussing the contributions of my work (\secref{sec:intro_contributions}) and the organization of the rest of this thesis (\secref{sec:intro_organization}).

\section{The Problem}
\label{sec:intro_problem}
As stated above, the major challenge for Wi-Fi networks today is configuration of the wireless network. To introduce the problem, I present two simple examples of configuration problems, and briefly explain why today's Wi-Fi solutions are insufficient.

\begin{figure}[thp]
	\centering
	\includegraphics[width=3in]{figures/single_link}
	\caption{\label{fig:wifi_link}A single Wi-Fi link, in which the transmitter $T$ sends data to the receiver $R$. No other wireless devices are present.}
\end{figure}

\subsection{Configuring a Single Link}
\label{sec:intro_single_link_problems}
The most basic wireless network is a single link (\figref{fig:wifi_link}), in which a transmitter sends data to one receiver, with no other devices present.

\subsubsection{Rate Selection}
Perhaps the simplest configuration goal for a wireless link is \define{rate selection}: the transmitter should send its data to the receiver using the fastest rate at which it will be successfully received. Sending data more slowly would be less efficient because the transmission would take longer and use more power than necessary. At the same time, sending faster would be inefficient because the data would not be received, wasting all the airtime and power consumed during the transmission.

In principle, selecting a rate for a wireless link should be trivial. As demonstrated by the seminal works of Ralph Hartley~\cite{Hartley_law} and Claude Shannon~\cite{Shannon_coding,Shannon_capacity}, the maximum data rate that can be delivered over a particular noisy channel (such as a wireless radio link) is determined entirely by the amount of power delivered to the receiver and the noise level present. This limit is quantified in the \define{signal-to-noise ratio}, or \define{SNR\@}. The transmitter need only measure the channel SNR and apply textbook formulas that can compute the error rates of particular modulations. The fastest rate can then be easily selected.

In practice, this approach has never worked for Wi-Fi links. Wi-Fi systems have never used channel measurements as more than a coarse indicator of expected performance. There have simply been too many ways in which the observed measurements and actual performance fail to match the predictions of theory. For example, hardware estimates of SNR can be mis-calibrated, the wireless channel can vary over packet reception, and can be corrupted by interference; all of these are known to be issues in practice~\cite{Camp_rateadapt,Judd_CHARM,Reis_sigcomm06}.

\subsubsection{Rate Adaptation}
Since rate selection based on channel measurements has never worked for Wi-Fi, practical systems use \define{rate adaptation} algorithms instead~\cite{Bicket_SampleRate,Minstrel,Wong_RRAA}. These are guided search schemes that simply test individual rates to see how well they work. When the loss rate is too high, a lower rate is used; otherwise a higher rate is tested. This approach is effective for slowly varying channels and simple links, since the best setting will soon be found.

It is important to note two trends for Wi-Fi links. First, they are increasingly used while mobile, both while walking indoors and in vehicles. Second, 802.11n devices that support fast rates now rely on the ability to send with multiple antennas, thereby adding another dimension to the search space. What this means is that algorithms to configure the rates of these links need to respond faster to match changing channels, while simultaneously choosing from among more possibilities. As a result, rate adaptation algorithms are getting less efficient as these systems change.

\subsubsection{Beyond Configuring Rate}
Thus far, I have described the challenges inherent to choosing an efficient rate to send data on a wireless link. On its own, this is a hard problem---with 802.11n, there are already at least two dimensions in which a rate adaptation algorithm must search. In addition, I note that rate is only one of many parameters to optimize for a Wi-Fi link. Combined, these make the full link optimization problem significantly harder.

For instance, a transmitter may want to trim excess transmit power to both save energy and reduce interference at nearby receivers. Or a sender might improve a link by choosing to send with a different subset of its transmit antennas, or by applying beamforming techniques to better match the signal to the channel and be received more reliably at the destination. And there are often many operating channels to choose from: though the set depends on the user's country, there are typically $\approx$10 channels in the 2.4\GHz band and $\approx$20 in the 5\GHz band.

Further still, note that these parameters are not generally independent---changing any one of them can affect the best operating point for another. For instance, switching the operating frequency can dramatically change the RF channel, and this in turn can affect which transmit antennas provide the best link, and how the transmitted signal should be shaped for maximum performance. Finally, all of these factors contribute to determining the best rate to use on the link.

We have now seen that fully optimizing a single wireless link involves choosing the right operating point in a large multi-dimensional space. In practice, the solution taken by hardware/driver manufacturers today is to simply ignore most of these dimensions. For instance, only Intel's \program{iwlwifi} driver, out of all the 802.11n drivers in the Linux kernel driver, adapts the transmit antenna set in an online manner. Similarly, few access points and no clients adjust transmit power for ongoing links, instead opting to transmit at the maximum power and guarantee the best link. The solutions work well enough for wireless access point networks as they are used today, mostly due to the simple way in which links are used. However, these solutions are inefficient for a single link---and in the next section, we will see that the problem gets even more complicated when performing network-level configuration of multiple devices that operate in multiple links.

\subsection{Configuring a Network of Devices}
\label{sec:intro_network_problems}
\figref{fig:network_examples} shows examples of three different decision problems that arise in configuring multi-device networks. We will use these three examples to illustrate how a network of devices has an significantly larger configuration space than a single link.

\subsubsection{Access Point Selection}
In \figref{fig:network_examples_ap}, on the left, the client $C$ wishes to join the network offered by the access points $AP_1$, $AP_2$, and $AP_3$. The \define{access point selection} problem is simple: the client should connect to the access point that provides the link with the best rate. However, in order to choose correctly, the client must accurately evaluate the rate offered by each access point. This in turn means that the client must have a way to assess its rate to each access point rapidly, i.e., a solution to the rate selection problem described above. Testing all access points using a rate adaptation-like approach would take too long and would take airtime away from ongoing connections. In practice clients simply connect the access point with the highest SNR\@. This heuristic approach provides only an approximation to the optimal solution, and would benefit from a better way to predict performance over measured wireless channels.

\subsubsection{Multi-hop Mesh Routing}
In \figref{fig:network_examples_mesh}, in the middle, the source $S$ wishes to send data to the destination $D$, and nodes $N_1$ and $N_2$ are also present in the network. The \define{multi-hop routing} problem is to choose the best path through the network by which to deliver data from $S$ to $D$. In this case, many paths are available, such as the direct path $S\mendash D$, the one-hop paths $S\mendash N_1\mendash D$ and $S\mendash N_2\mendash D$, and finally $S\mendash N_1\mendash N_2\mendash D$. To evaluate the different paths, we need to know the rate available on each hop, which in this case would require knowing the rates of six different links. Once again, measuring the ground truth rate of each link by testing each configuration would likely take too long, and would add overhead to the network.

Practical work in this area primarily takes one of two approaches. Most of the wireless mesh research in the past decade avoided this problem by simply ignoring many of the dimensions of the configuration space. These papers not only used single antenna systems at fixed transmit powers, but also typically fixed the entire network to a single rate. The alternative approach, taken by a few recent papers, has been to collected statistics about packet delivery between all pairs of nodes for different rates, and estimate the rate from the measured SNR for links without sufficient statistics. These recent works have exclusively handled single-antenna 802.11a/b/g networks, and would likely be forced to rely on SNR-based rate predictions if the underlying links used 802.11n instead.

\subsubsection{Exposed Terminals}
The third example, shown in \figref{fig:network_examples_exposed}, is the \define{exposed terminal} problem. Here, two independent links both wish to communicate at the same time and in the same frequency, and need to share the wireless medium. If the links share the medium, for example each using half the airtime, then each gets half of the rate as if they were operating alone. In certain situations, depending on the placement of the four devices and the amount of interference between links, it may provide more total throughput for the links to send concurrently, each using all of the airtime but maybe using a slightly lower rate.

Once again, deciding which of these two possibilities is better requires the system to predict the rate on multiple different links. In this case, the rate needs to be predicted not only for each link in isolation, but also for every possible pair of configurations of the links. In this case, and unlike the prior two problems, the size of the resulting configuration space is the product of the sizes of the space of each individual link. As a result, CMAP~\cite{Vutukuru_CMAP} and CENTAUR~\cite{Shrivastava_CENTAUR}, the primary practical works on exposed terminals for Wi-Fi, simply fixed the entire network to a single rate in their experiments.

\subsubsection{Summary}
In this section, I presented three network-level configuration problems and explained why their solution space is significantly larger than for a single link. Depending on the problem being solved, these configuration problems can have increased complexity that is linear in the number of devices (AP selection), quadratic (Multi-hop routing), or even exponential (Exposed terminals).

Additionally, these scenarios tend to differ from the single link case in that their solutions can not be fluidly adapted while online. For instance, a transmitter on a single link could rapidly adapt its rate or antenna selection, and a poor choice will be rapidly corrected. Conversely, a client in today's wireless networks cannot switch between access point at short time scales. Thus it is especially important that these network-level decision problems are made accurately the first time.

Finally, note that these network-level configuration problems are representative of the problems that Wi-Fi Direct networks will have to solve to build rich device-to-device applications. As the networks and the applications they need to support get more complicated, these problems get more relevant, and a better solution becomes more important. In the next section, I will present my solution to this problem, which I develop in this thesis.

\section{Approach and Contributions}
\label{sec:intro_approach}
As we saw in the previous section, the problems we need to solve when configuring Wi-Fi networks are increasingly complex and involve larger configuration spaces from which to find an effective solution. The heuristic and adaptation-based approaches used in the simple network problems solved today will not scale to these bigger problems. Instead, what we need is a way to accurately and rapidly assess the quality of links for all the factors mentioned in \secref{sec:intro_single_link_problems}, and use this process to inform joint optimization problems such as those described in \secref{sec:intro_network_problems}.

\subsection{Approach}
My approach to this problem is to return to the basic problem of using theory to connect the performance of 802.11 devices on real links to measured channels in practice. Though this was intractable in the past, there are three reasons for the opportunity to make progress.
\begin{itemize}
\item First, 802.11n devices measure the channel at the level of individual OFDM subcarriers and individual spatial paths to support 802.11n MIMO (multi-antenna) operation. They report this information in a standard Channel State Information (CSI) format~\cite[\S7.3.1.27]{80211n}.

To compare the CSI with SNR, consider an 802.11n link with $M$ and $N$ antennas respectively at the transmitter and receiver. Today's receivers measure $N$ SNR values, each corresponding to the total power measured at one receive antenna. In contrast, the CSI contains $M$$\times$N$\times$$S$ values, where $S$ is the number of subcarriers measured. This results in a factor of $MS$ more channel measurements when measuring CSI as opposed to SNR\@. In 802.11, the CSI can measure from 1 to 4 antennas, and from 16 to 114 subcarriers. The CSI thus includes between 16$\times$ ($M=1$, $S=16$) and $456\times$ ($M=4$, $S=114$) as many measurements as the SNR\@.
\item Second, the quality of Wi-Fi hardware has improved dramatically. Manufacturers typically calibrate chipsets across a wide range of conditions, including temperature and transmit power level, in order to meet regulatory requirements, to meet standardized tolerances, and to maximize performance. The modern use of OFDM and MIMO techniques additionally enables channel estimates that are less susceptible to interference than spread-spectrum modulation (because of lower correlation), and can be taken more rapidly.
\item Finally, there is a recent body of theoretical work on measuring and predicting the error performance of wireless channels that are faded, use OFDM, or use MIMO\@. Chief among these is the seminal 1998 paper by Nanda and Rege on the concept of \emph{Effective $E_b/N_0$}~\cite{Nanda_effectiveSNR}, which forms the theoretical basis of my model for 802.11n MIMO-OFDM channels.
\end{itemize}
In my thesis, I take advantage of these three factors to build a practical system to return to the ``traditional'' algorithm and predict wireless error performance from channel measurements. Rather than the ``try-it-and-see'' adaptation algorithms in use today, my model enables measurement-based selection of operating points for a wide range of transmitter and receiver parameters over a large application space.

%The opportunity to make progress has arisen for two reasons. First, 802.11n devices measure the channel at the level of individual OFDM subcarriers and individual spatial paths to support 802.11n MIMO (multi-antenna) operation. They report this information in a standard Channel State Information (CSI) format~\cite[\S7.3.1.27]{80211n}. This provides a much richer source of information than SNR\@. Note that this CSI naturally applies to 802.11a/g rates because they are a subset of 802.11n rates. Second, modern NICs use OFDM, which gives channel estimates that are less susceptible to interference than spread spectrum (because of lower correlation), and are calibrated. Both factors lead to more meaningful measurements than in the past.


%\subsubsection{Better Channel Measurements}
%The chief problems with using channel measurements available in commodity Wi-Fi devices is that they only describe the SNR, a measure of total power in the channel. Even if they didn't suffer from the hardware artifacts described above, this information would insufficiently describe the wireless channel, because bits are no longer spread across the entire band as in 802.11b modes, but instead are sent independently on different frequencies (called subcarriers) with orthogonal frequency division multiplexing (OFDM), and on different spatial paths with 802.11n multi-antenna techniques.
%
%As part of my thesis, I built a tool (described in \secref{sec:tool}) to measure the channel in a fine-grained manner that accurately reflects the underlying radio channel. In particular, this tool can measure the 802.11n Channel State Information (CSI)~\cite[\S7.3.1.27]{80211n} for each received 802.11n packet. The CSI measures not just the SNR of the entire channel, but instead the channel response at the level of individual subcarriers and spatial paths. For comparison, for an 802.11n link with the antennas each at the transmitter and receiver, today's receivers measure three SNR values each corresponding to the total power measured at a receive antenna. In contrast, the CSI contains 3$\times$3$\times$$S$ values, where $S$ is the number of subcarriers measured. Since 802.11n links use either 56 or 114 subcarriers, $S$ could be as high as 56; in practice, our tool can only measure a subset of 30 of them. Still, this results in 270 channel measurements using the CSI, compared to only 3 with the traditional SNR\@.
%My tool uses a commercially-available Intel Wi-Fi device that supports 802.11n. I modified the open-source Linux drivers, and---in conjunction with Intel Research---the firmware for these devices to enable debug modes with 
%\subsubsection{Effective SNR}


\subsection{Contributions}
\label{sec:intro_contributions}

The contributions of this thesis are threefold:
\begin{itemize}
\item First, I develop a model that uses the 802.11n CSI to predict the error performance of different transmitter configurations on the wireless channel. This model is flexible to support a wide variety of transmitter and receiver device capabilities, device implementations, and applications. I also detail how to use this model to solve a large number and variety of configuration problems similar to those in \secref{sec:intro_problem}.
\item Second, I design and implement a measurement tool that uses commodity 802.11n wireless devices to measure the 802.11n CSI for the wireless channel, and use this tool to apply my model to real measured 802.11n channels. I have also released this tool publicly, and at the time of writing it is in use at 18 universities, research labs, and corporations.
\item Finally, I conduct detailed experimental evaluations of my Effective SNR-based model for 802.11n that show that it accurately predicts performance for a wide variety of applications, and improves the performance of these applications over versions that use the channel measurements available today.
\end{itemize}

\section{Organization of This Thesis}
\label{sec:intro_organization}
This thesis is organized as follows. In \chapref{chap:background}, I provide background information on wireless signals and systems in general, and the IEEE 802.11 standards in particular. \chapref{chap:problem} introduces the problem with using channel measurements to predict wireless link performance in today's hardware and using today's techniques, and introduces my Effective SNR-based approach to solving it. In \chapref{chap:model}, I develop my Effective SNR model for 802.11n link performance, and demonstrate its effectiveness at handling a wide range of transmitter and receiver configurations as well as wireless applications. I then describe my measurement tool, experimental apparatus, and basic measurements in \chapref{chap:tool}, and then use these measurements to evaluate the ability of my model to predict error performance over a single link in \chapref{chap:delivery}. Next, I conduct a detailed study of the model in the context of rate selection for 802.11n in \chapref{chap:rate}, and then present brief results for a variety of other applications in \chapref{chap:applications}. Finally, \chapref{chap:conclusion} contains a discussion of future directions for this research my concluding thoughts.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifx\mainfile\undefined
\input{chapter_tail}
\fi
