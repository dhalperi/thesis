\ifx\mainfile\undefined
\input{chapter_head}
\setcounter{chapter}{2} % Set to n-1!
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Problem and Approach}
\label{chap:problem}
\label{chap:approach}

The problem I study in this thesis is how to inform configuration decisions for wireless networks. I begin this chapter by presenting some of the primary problems in this space. Second, I discuss how we handle these problems today: there are two primary classes of techniques: (1) \emph{SNR-based} schemes which use measurements of the total signal power in a channel to predict packet delivery, and (2) \emph{probe-based} schemes which use packet reception or loss as a high-level indicator of channel performance. Finally, I conclude this chapter by presenting the hypothesis of my research, and my approach to demonstrating it.

%According to the standards makers, one of the intended purposes of the RSSI is ``to aid in link optimization algorithms such as roaming decisions''~\cite[\S 19.9.5.10]{80211}.

\section{Wireless Configuration}

\section{SNR-based Configuration Procedure}
As I described in the last section (\figref{fig:mod_ber_snr}), textbook analyses of modulation schemes give delivery probability for a single signal in terms of the signal-to-noise (SNR) ratio~\cite{Goldsmith}.
These theoretical models hold for narrowband channels with additive white Gaussian noise. They predict a sharp transition region of 1--2\dB over which a link changes from extremely lossy to highly reliable. This feature in theory makes the SNR a valuable indicator of performance.

This gives rise to a simple SNR-based configuration scheme, at least for selecting rate: Upon receiving a packet, a device can use the measured RSSI to compute SNR and predict the fastest rate supported. It can then feed this information back to the transmitter, which will use the newly selected rate for subsequent transmissions.

\subsection{Packet Delivery versus SNR in Practice}
To understand how well the performance of real hardware matches theory, I generated performance curves using an Intel Wireless Wi-Fi Link 5300 a/g/n (\program{iwl5300}) wireless network card. I connected two network cards together via a wire, and configured them to operate in a mode that uses a single antenna to transmit or receive. Using an inline variable attenuator I varied the amount of power received, and for each power level I sent around 1,000 packets using each of the eight 802.11n single-stream rates (\tabref{tab:siso_mcs}) and measured the fraction of delivered packets, the \define{packet reception ratio (PRR)}. With these measurements, I plotted the PRR against the link's SNR (computed from RSSI measurements at the receiver), and present the result in \figref{fig:snr_prr_attenuator}. 

\begin{figure}[t!]
	\centering
%	\includegraphics[width=\textwidth,viewport=13 0 364 204,clip]{figures/esnr/embed_attenuator_snr_prr.pdf}
	\includegraphics[width=\textwidth]{figures/snr_prr_atten.pdf}
	\caption{\label{fig:snr_prr_attenuator}A wired 802.11n link with variable attenuation has a predictable relationship between SNR and packet reception rate (PRR) and clear separation between rates.}
\end{figure}
\begin{figure}[t!]
	\centering
%	\includegraphics[width=\textwidth,viewport=2 0 217 124,clip]{figures/esnr/embed_scatterplot_meas_snr_small.pdf}
	\includegraphics[width=\textwidth]{figures/snr_prr_scatter.pdf}
	\caption{\label{fig:snr_prr_26_65} Over real wireless channels in our testbeds, the transition region varies by 10\dB or more. The wireless channel loses the clear separation between rates (and so only three rates are shown for legibility).}%
\end{figure}

This figure shows a characteristic sharp transition region between SNR values at which the link goes from lossy to working, 2\dB at low modulations up to 4\dB for the fastest 65\Mbps rate. There is also a clear separation between rates: at a given SNR value, it is clear which rate should be used. This wired link provides a good approximation of a theoretical narrowband channel despite the relatively wide 20\MHz channel, the use of 56 OFDM subcarriers, coding and other bit-level operations. This is the behavior we would want from a link metric in order to predict packet delivery.

In contrast, packet delivery over real wireless channels does not exhibit the same picture. \figref{fig:snr_prr_26_65} shows the measured PRR versus SNR for three sample rates (6.5\Mbps, 26\Mbps, and 65\Mbps) over all wireless links in our testbeds, using the same 802.11n NICs. The SNR of the transition regions can exceed 10\dB, so that some links easily work for a given SNR and others do not. There is no longer clear separation between rates. This is consistent with other reported measurements that show that SNR based on RSSI does not predict packet delivery for real links~\cite{aguayo_roofnet, Reis_sigcomm06, snr_infocom08, zhao_sensys03}.

\subsection{Rate Selection using SNR in Practice}
Here, I analyze the accuracy of the SNR estimate computed from RSSI when used to select rates over wireless links. For 202 indoor, single-antenna wireless links I measured the relationship between SNR and PRR while varying the transmit power level (and hence the received SNR). For each rate on each link, I determined the SNR level at which that rate resulted in more throughput than the next lower rate. For example, I found the SNR value at which the 19.5\Mbps rate has a PRR of at least 66.6\%, because then it can deliver more rate than the 13\Mbps rate.

\begin{figure}[t]
	\centering
	\includegraphics[width=\textwidth]{figures/thresh_vs_opt.pdf}
	\caption{\label{fig:thresh_vs_opt}The accuracy of selecting rate using SNR for thresholds derived from differing percentiles of the transition region. [XXXNote: I think this data is a bit wrong, and need to revisit]}
\end{figure}
Using the per-rate SNR thresholds across all links, I can select one threshold value as some percentile of this set. Using low SNR thresholds gives an aggressive rate selection algorithm, that will perform sub-optimally because it sends packets too fast to be received.  Conversely, a conservative algorithm will choose high SNR thresholds, leading to sub-optimal performance as packets are sent slower than necessary. \figref{fig:thresh_vs_opt} shows the relationship between threshold and performance, using the 0th percentile (lowest, most aggressive thresholds) up to the 100th percentile (highest, most conservative thresholds). We see that no threshold---aggressive, conservative, or somewhere in the middle---provides good performance across the range of real wireless links.

\section{Packet Statistics}

\section{My Approach}
My hypothesis is that physical layer measurements can indeed be useful indicators of wireless link performance in practice, and that these measurements can be used to inform a wide array of link and network configuration problems. My approach to resolving this hypothesis is to build a system that demonstrates that this is true. In particular, I (1) prototype an 802.11n-based system to obtain more accurate, fine-grained physical layer information about wireless channels, (2) develop a practical methodology that uses this information and the concept of an effective SNR~\cite{Nanda_EffectiveSNR} to predict performance for wireless channels, and demonstrate that it works, and (3) show that it informs a wide variety of link and network configuration problems and performs better than state of the art algorithms to solve the same problems.

\begin{figure}[t]
  \centering
%  \includegraphics[width=\columnwidth,viewport=2 9 185 108,clip]{figures/esnr/embed_fsf-shape-two-links.pdf}
  \includegraphics[width=0.8\textwidth]{figures/fsf_shape.pdf}
  \caption{Channel gains on four links that perform about equally well at 52\Mbps. The more faded links require larger RSSIs (i.e., more transmit power) to achieve similar PRRs.}
  \label{fig:example_fsf_shape}
  % information for the links used to make above plot: 
  %srcs = [1 10 3 3];
  %dests = [9 11 2 5];
  %txpowers = [-4 20 28 20];

  % reference numbers from expt-8
  %prr = [80 83 78 74];
  %rss = [16.5 30.2 27.1 18.2];
\end{figure}

\subsection{Fine-grained RF Measurements: SNR vs CSI}
To contrast CSI and SNR, \figref{fig:example_fsf_shape} shows packet delivery rates, RSSIs, and subcarrier-level CSI for four links that exhibit similar performance when using the 802.11n single-stream 52\Mbps rate. Multipath causes some subcarriers to work markedly better than others although all use the same modulation and coding. These channel details, and not simply the overall signal strength as given by RSSI, affect packet delivery. The fading profiles vary significantly across the four links. One distribution is quite flat across the subcarriers, while the other three exhibit frequency-selective fading of varying degrees. Two of the links have two deeply-faded subcarriers that are more than 20\dB down from the peak.

These links harness the received power with different efficiencies.
The more faded links are more likely to have errors that must be repaired with coding, and require extra transmit power to compensate. Thus, while the performance is roughly the same, the most frequency-selective link needs a much higher overall packet SNR~(30.2\dB) than the frequency-flat link (16.5\dB). This difference of almost 14\dB highlights why RSSI-based SNR does not reliably predict performance. Fading and its effects are well-known. However, it is rare to see data that shows fading for real links and NICs because it has been difficult to measure.

\subsection{Effective SNR-based Model}
The example of \figref{fig:example_fsf_shape} indicated that the extra information in CSI can help explain performance for real wireless links. Here, we develop a model that can accurately predict the packet delivery probability of commodity 802.11 NICs for a given physical layer configuration operating over a given channel. We want our model to be simple and practical, so that it can be readily deployed, and to cover a wide range of physical layer configurations, so that it can be applied in many settings and for many tasks. In particular, the scope of our model is 802.11n including multiple antenna modes, including OFDM and MIMO\@. This scope is sufficient for many current and future networks. In our preliminary work, we have modeled delivery for single packet transmission only.

\heading{Model Design.}
The structure of our model is simple: given 1) a current CSI measurement of the RF channel between transmitter and receiver, and 2) a target physical layer configuration of the transmit and receive NICs, it predicts whether that link will reliably deliver packets in that configuration.
With this simple decision primitive, we can easily build higher layer optimization protocols. These include selecting the best rate, number of spatial streams, or transmit antenna set; whether to use 20\MHz or the entire 40\MHz channel; or choosing the lowest transmit power at which the link supports a particular rate.

For the model output, we define that the link will work, i.e., will reliably deliver packets, if we predict $\geq$90\% packet reception rate. We do not try to make predictions in the transition region during which a link changes from lossy to reliable. Predictions there are likely to be variable, and simply knowing when the link starts to work is useful information in practice.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifx\mainfile\undefined
\input{chapter_tail}
\fi
